<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bitcoin BIP-39 / BIP-32 Educational Viewer (Offline)</title>

<style>
body{
    background:#020617;
    color:#e5e7eb;
    font-family:Segoe UI,Arial;
    margin:20px
}
h1{font-size:22px}
textarea,input{width:100%;background:#020617;color:#e5e7eb;border:1px solid #334155;padding:10px}
button{background:#2563eb;color:white;border:none;padding:10px 16px;margin-top:10px;cursor:pointer}
.tabbar{display:flex;gap:10px;margin-top:20px}
.tab{padding:8px 14px;border:1px solid #334155;cursor:pointer}
.tab.active{background:#2563eb}
.section{margin-top:20px;border:1px solid #334155;border-radius:6px;padding:14px}
.label{color:#93c5fd;font-weight:bold;margin-bottom:6px}
.value{font-family:monospace;word-break:break-all;font-size:13px}
.error{color:#fca5a5;border-color:#7f1d1d}
svg{margin-top:10px}
.hidden{display:none}
</style>
</head>
<body>

<h1>Bitcoin BIP-39 → BIP-32 → Address (Educational)</h1>

<textarea id="mnemonic" placeholder="Enter BIP-39 mnemonic"></textarea>
<input id="passphrase" placeholder="Optional passphrase">
<button onclick="run()">Generate</button>

<div class="tabbar">
  <div class="tab active" onclick="showTab('mnemonicTab')">Mnemonic</div>
  <div class="tab" onclick="showTab('keysTab')">Keys</div>
  <div class="tab" onclick="showTab('addressTab')">Address</div>
</div>

<div id="mnemonicTab"></div>
<div id="keysTab" class="hidden"></div>
<div id="addressTab" class="hidden"></div>

<script>
/* ========= UTIL ========= */
const enc=new TextEncoder()
const dec=new TextDecoder()
const hex=b=>[...b].map(x=>x.toString(16).padStart(2,"0")).join("")
const bytes=h=>new Uint8Array(h.match(/.{2}/g).map(x=>parseInt(x,16)))

function box(tab,title,val,err=false){
  const d=document.createElement("div")
  d.className="section"+(err?" error":"")
  d.innerHTML=`<div class="label">${title}</div><div class="value">${val}</div>`
  document.getElementById(tab).appendChild(d)
}

/* ========= SHA / HMAC ========= */
async function sha256(b){return crypto.subtle.digest("SHA-256",b)}
async function hmac(key,data){
  const k=await crypto.subtle.importKey("raw",key,{name:"HMAC",hash:"SHA-512"},false,["sign"])
  return crypto.subtle.sign("HMAC",k,data)
}

/* ========= RIPEMD160 ========= */
function ripemd160(m){
  function f(j,x,y,z){return j<16?x^y^z:j<32?(x&y)|(~x&z):j<48?(x|~y)^z:j<64?(x&z)|(y&~z):x^(y|~z)}
  function K(j){return j<16?0:j<32?0x5a827999:j<48?0x6ed9eba1:j<64?0x8f1bbcdc:0xa953fd4e}
  function Kp(j){return j<16?0x50a28be6:j<32?0x5c4dd124:j<48?0x6d703ef3:j<64?0x7a6d76e9:0}
  function rot(x,n){return(x<<n)|(x>>>32-n)}
  const r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2]
  const rp=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13]
  const s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5]
  const sp=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5]
  let msg=[...m,0x80]
  while((msg.length%64)!==56)msg.push(0)
  let l=m.length*8
  for(let i=0;i<8;i++)msg.push(l>>>(8*i)&255)
  let h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]
  for(let i=0;i<msg.length;i+=64){
    let w=[]
    for(let j=0;j<16;j++)w[j]=msg[i+4*j]|msg[i+4*j+1]<<8|msg[i+4*j+2]<<16|msg[i+4*j+3]<<24
    let [a,b,c,d,e]=h,[ap,bp,cp,dp,ep]=h
    for(let j=0;j<48;j++){
      let t=(rot(a+f(j,b,c,d)+w[r[j]]+K(j),s[j])+e)>>>0
      a=e;e=d;d=rot(c,10);c=b;b=t
      let tp=(rot(ap+f(47-j,bp,cp,dp)+w[rp[j]]+Kp(j),sp[j])+ep)>>>0
      ap=ep;ep=dp;dp=rot(cp,10);cp=bp;bp=tp
    }
    let t=(h[1]+c+dp)>>>0
    h[1]=(h[2]+d+ep)>>>0
    h[2]=(h[3]+e+ap)>>>0
    h[3]=(h[4]+a+bp)>>>0
    h[4]=(h[0]+b+cp)>>>0
    h[0]=t
  }
  return new Uint8Array(h.flatMap(x=>[x&255,(x>>8)&255,(x>>16)&255,(x>>24)&255]))
}

/* ========= BASE58 ========= */
const ALPH="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"
function base58(buf){
  let x=BigInt("0x"+hex(buf)),out=""
  while(x){out=ALPH[x%58n]+out;x/=58n}
  for(let b of buf){if(b===0)out="1"+out;else break}
  return out
}

/* ========= MAIN ========= */
async function run(){
  mnemonicTab.innerHTML=""
  keysTab.innerHTML=""
  addressTab.innerHTML=""

  const m=document.getElementById("mnemonic").value.trim()
  if(m.split(" ").length%3!==0)
    return box("mnemonicTab","Mnemonic Error","Invalid word count",true)

  box("mnemonicTab","Mnemonic",m)

  const seed=await crypto.subtle.deriveBits(
    {name:"PBKDF2",salt:enc.encode("mnemonic"+passphrase.value),iterations:2048,hash:"SHA-512"},
    await crypto.subtle.importKey("raw",enc.encode(m),"PBKDF2",false,["deriveBits"]),
    512)

  box("keysTab","BIP-39 Seed",hex(new Uint8Array(seed)))

  const I=await hmac(enc.encode("Bitcoin seed"),seed)
  const IL=new Uint8Array(I.slice(0,32))
  box("keysTab","Master Private Key",hex(IL))

  /* ===== Public Key ===== */
  const jwk={kty:"EC",crv:"secp256k1",d:hex(IL),ext:true}
  const priv=await crypto.subtle.importKey("jwk",jwk,{name:"ECDSA",namedCurve:"secp256k1"},true,["sign"])
  const pub=await crypto.subtle.exportKey("raw",await crypto.subtle.importKey("jwk",jwk,{name:"ECDSA",namedCurve:"secp256k1"},true,["verify"]))
  box("keysTab","Uncompressed Public Key","04"+hex(new Uint8Array(pub)))

  const hash160=ripemd160(new Uint8Array(await sha256(pub)))
  box("addressTab","HASH160",hex(hash160))

  const payload=new Uint8Array([0x00,...hash160])
  const checksum=new Uint8Array(await sha256(await sha256(payload))).slice(0,4)
  const addr=base58(new Uint8Array([...payload,...checksum]))
  box("addressTab","Bitcoin Address",addr)
}

function showTab(id){
  for(let t of ["mnemonicTab","keysTab","addressTab"])
    document.getElementById(t).classList.add("hidden")
  document.getElementById(id).classList.remove("hidden")
  document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"))
  event.target.classList.add("active")
}
</script>
</body>
</html>
